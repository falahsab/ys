<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„Ù…Ø­ØªØ±ÙÙˆÙ† Ø³ØªÙ„Ø§ÙŠØª</title>

<style>
*{box-sizing:border-box;}
body{font-family: Tahoma, Arial, sans-serif;background:#f2f4f7;padding:15px;}
.container{max-width:420px;margin:auto;background:#fff;padding:18px;border-radius:14px;box-shadow:0 5px 15px rgba(0,0,0,.1);}
h2{text-align:center;margin-bottom:15px;font-size:20px;}
input{width:100%;padding:14px;font-size:17px;border:1px solid #ccc;border-radius:10px;margin-bottom:5px;}
input.valid{border-color:#28a745;}
input.invalid{border-color:#b02a37;}
button{width:100%;padding:14px;font-size:17px;border:none;border-radius:10px;cursor:pointer;}
button:disabled{opacity:.6;}
.check{background:#0d6efd;color:#fff;}
.whatsapp{background:#25d366;color:#fff;margin-top:12px;}
.result{margin-top:15px;padding:15px;border-radius:12px;font-size:15px;line-height:1.9;}
.success{background:#e9f8ef;color:#146c43;}
.error{background:#fdecea;color:#b02a37;}
.code-box{background:#fff3cd;color:#664d03;padding:10px;border-radius:8px;text-align:center;font-weight:bold;margin-top:8px;}
.footer{text-align:center;font-size:13px;margin-top:15px;color:#777;}
.loader{border:4px solid #eee;border-top:4px solid #0d6efd;border-radius:50%;width:30px;height:30px;animation:spin 1s linear infinite;margin:12px auto 0;}
.warning{color:#b02a37;font-size:14px;margin-bottom:8px; display:none;}
.success-warning{color:#28a745;font-size:14px;margin-bottom:8px; display:none;}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
@media (max-width:480px){h2{font-size:18px}input,button{font-size:16px}}
</style>
</head>

<body>

<div class="container">
  <h2>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</h2>
  <input type="text" id="snumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² (12 Ø±Ù‚Ù…)" inputmode="numeric">
  <div id="lengthWarning" class="warning">âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø¯Ø®Ø§Ù„ Ø§ÙƒØ«Ø± Ù…Ù† 12 Ø±Ù‚Ù… ÙÙ‚Ø·</div>
  <div id="validHint" class="success-warning">âœ… ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­ØªÙ‡ Ù‚Ø¨Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰(ØªØ­Ù‚Ù‚)</div>
  <button class="check" id="checkBtn" onclick="checkSerial()">ØªØ­Ù‚Ù‚</button>
  <div id="result"></div>
  <div class="footer">Â© Ø§Ù„Ù…Ø­ØªØ±ÙÙˆÙ† Ø³ØªÙ„Ø§ÙŠØª</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwEtMQ9Iny1_VhChsytECSAaf4AFDyJ9HTaT_Y1sJC4IYCeSLHx843BFjCW1uNKrruQ0w/exec";
const WHATSAPP_NUMBER = "967711831502";

const snumberInput = document.getElementById("snumber");
const lengthWarning = document.getElementById("lengthWarning");
const validHint = document.getElementById("validHint");
let warningTimeout;

/* Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø· + Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 12 Ø±Ù‚Ù… + Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª */
snumberInput.addEventListener("input", function(){
  // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø´ÙŠØ¡ Ù„ÙŠØ³ Ø±Ù‚Ù…
  this.value = this.value.replace(/\D/g,'');

  if(this.value.length > 12){
    // Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø²Ø§Ø¦Ø¯
    this.value = this.value.slice(0,12);

    // Ø¹Ø±Ø¶ Ø§Ù„ØªØ­Ø°ÙŠØ± Ù„Ù…Ø¯Ø© Ø«Ø§Ù†ÙŠØªÙŠÙ†
    lengthWarning.style.display = "block";
    validHint.style.display = "none";
    clearTimeout(warningTimeout);
    warningTimeout = setTimeout(()=>{lengthWarning.style.display = "none";},2000);
  }

  // Ø¥Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… ØµØ­ÙŠØ­ 12 Ø±Ù‚Ù…
  if(this.value.length === 12){
    validHint.style.display = "block";
  } else {
    validHint.style.display = "none";
  }
});

/* ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø®ØµÙ… */
function generateCode(snumber){
  const mid = snumber.substr(4,4); // Ø§Ù„Ø£Ø±Ø¨Ø¹Ø© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙˆØ³Ø·Ù‰
  const lastTwo = snumber.substr(-2);
  const mul = Number(lastTwo[0]) * Number(lastTwo[1]);
  return "yemnsat"+mid+mul;
}

function checkSerial(){
  const snumber = snumberInput.value.trim();
  const result = document.getElementById("result");
  const btn = document.getElementById("checkBtn");

  if(snumber.length !== 12){
    result.innerHTML = "<div class='result error'>âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² (12 Ø±Ù‚Ù…)</div>";
    return;
  }

  btn.disabled = true;
  result.innerHTML = `<div class="result">â³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚...<div class="loader"></div></div>`;

  fetch(`${API_URL}?snumber=${encodeURIComponent(snumber)}`)
    .then(res => res.json())
    .then(data => {
      btn.disabled = false;

      if(data.found == true){
        const code = generateCode(snumber);
        const msg = `Ù…Ø¨Ø±ÙˆÙƒ ğŸ‰
Ø±Ø³ÙŠÙØ±Ùƒ Ø­Ø§ØµÙ„ Ø¹Ù„Ù‰ Ø®ØµÙˆÙ…Ø§Øª Ø­ØµØ±ÙŠØ© Ù…Ù† ÙŠÙ…Ù† Ø³ØªÙ„Ø§ÙŠØª

Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…:
â€¢ Ø´Ù‡Ø±: ${data.vip1m}
â€¢ 3 Ø£Ø´Ù‡Ø±: ${data.vip3m}
â€¢ 6 Ø£Ø´Ù‡Ø±: ${data.vip6m}
â€¢ Ø³Ù†Ø©: ${data.vip12m}

Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²:
${snumber}

ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…:
${code}`;

        const waLink = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}&update=1&snumber=${snumber}`;

        result.innerHTML = `
          <div class="result success">
            ğŸ‰ <b>Ù…Ø¨Ø±ÙˆÙƒ!</b><br>
            Ø±Ø³ÙŠÙØ±Ùƒ Ø­Ø§ØµÙ„ Ø¹Ù„Ù‰ Ø®ØµÙˆÙ…Ø§Øª Ø­ØµØ±ÙŠØ© Ù…Ù† ÙŠÙ…Ù† Ø³ØªÙ„Ø§ÙŠØª<br><br>

            ğŸ’° Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…:<br>
            â€¢ Ø´Ù‡Ø±: ${data.vip1m}<br>
            â€¢ 3 Ø£Ø´Ù‡Ø±: ${data.vip3m}<br>
            â€¢ 6 Ø£Ø´Ù‡Ø±: ${data.vip6m}<br>
            â€¢ Ø³Ù†Ø©: ${data.vip12m}<br><br>

            ğŸ” ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…:
            <div class="code-box">${code}</div>

            ğŸ“Ÿ Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²:
            <div class="code-box">${snumber}</div>

            <a href="${waLink}" target="_blank" onclick="updateCountbuy('${snumber}')">
              <button class="whatsapp">ğŸ“² Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
            </a>
          </div>
        `;

      } else {
        const msg1 = `Ø§Ø±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø±Ø³ÙŠÙØ±ÙŠ Ù„Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø®ØµÙˆÙ…Ø§ØªÙƒÙ…\n\nØ±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² (snumber):\n${snumber}`;
        const waLink1 = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg1)}`;

        result.innerHTML = `
          <div class="result error">âŒ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ù„Ø¯ÙŠÙ†Ø§</div>
          <div class="result success">
âœ… Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø§Ø¯Ù†Ø§Ù‡ Ù„ØªØ³Ø¬ÙŠÙ„Ù‡ ÙˆØ§Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª
            <a href="${waLink1}" target="_blank">
              <button class="whatsapp">ğŸ“² ØªØ³Ø¬ÙŠÙ„Ù‡ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
            </a>
          </div>
        `;
      }
    })
    .catch(()=>{
      btn.disabled = false;
      result.innerHTML = "<div class='result error'>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>";
    });
}

/* ØªØ­Ø¯ÙŠØ« countbuy Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ */
function updateCountbuy(snumber){
  fetch(`${API_URL}?snumber=${encodeURIComponent(snumber)}&update=1`)
    .catch(e=>console.log("Ø®Ø·Ø£ ØªØ­Ø¯ÙŠØ« countbuy", e));
}
</script>

</body>
</html>
