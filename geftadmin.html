<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø£Ø¬Ù‡Ø²Ø© ÙŠÙ…Ù† Ø³ØªÙ„Ø§ÙŠØª</title>

<style>
*{box-sizing:border-box;font-family:Tajawal,Arial}
body{margin:0;background:#f4f6f9}
header{
  background:#0d6efd;
  color:#fff;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header button{
  background:#fff;
  color:#0d6efd;
  border:none;
  padding:8px 14px;
  border-radius:10px;
  cursor:pointer;
}

.container{max-width:1100px;margin:auto;padding:15px}

/* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¨Ø­Ø« */
.search-box{
  position:relative;
}
.search-box input{
  width:100%;
  padding:12px 40px 12px 12px;
  border-radius:12px;
  border:1px solid #ccc;
  margin-bottom:15px;
}
.paste-btn{
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  cursor:pointer;
  font-size:18px;
  opacity:.7;
}
.paste-btn:hover{
  opacity:1;
}

/* Ø§Ù„ÙƒØ±ÙˆØª */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:15px;
}
.card{
  background:#fff;
  border-radius:16px;
  padding:15px;
  box-shadow:0 6px 15px rgba(0,0,0,.08);
  cursor:pointer;
}
.card .user{color:#0d6efd;font-weight:bold}
.card .device{color:#555}

/* ===== Ù…ÙˆØ¯Ø§Ù„ ===== */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  justify-content:center;
  align-items:center;
  z-index:999;
}
.modal-content{
  background:#fff;
  width:95%;
  max-width:420px;
  padding:20px;
  border-radius:18px;
}
.modal-content input{
  width:100%;
  padding:11px;
  margin-bottom:8px;
  border-radius:10px;
  border:1px solid #ccc;
}
.modal-content input#snumber{
  /* Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² 12 Ø±Ù‚Ù… ÙÙ‚Ø· */
  ime-mode: numeric;
}
.modal-content input#usernumber{
  /* Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø· */
  ime-mode: numeric;
}
.modal-content button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  cursor:pointer;
}
.save{background:#198754;color:#fff;margin-top:6px;}
.close{background:#adb5bd;margin-top:6px}
</style>
</head>

<body>

<header>
  <span>ğŸ“¡ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</span>
  <button onclick="openAdd()">â• Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø²</button>
</header>

<div class="container">
  <div class="search-box">
    <input id="search" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² Ø£Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" inputmode="numeric">
    <span class="paste-btn" onclick="pasteFromClipboard()">ğŸ“‹</span>
  </div>
<!-- Ø¯Ø§Ø®Ù„ containerØŒ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ±ÙˆØª -->
<div id="totalDevices" style="margin-bottom:10px;font-weight:bold;color:#0d6efd;"></div>

  <div class="cards" id="cards"></div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ -->
<div class="modal" id="modal">
  <div class="modal-content">
    <input id="usernumber" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <input id="snumber" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²">
    <input id="vip1m" placeholder="Ø´Ù‡Ø±">
    <input id="vip3m" placeholder="3 Ø£Ø´Ù‡Ø±">
    <input id="vip6m" placeholder="6 Ø£Ø´Ù‡Ø±">
    <input id="vip12m" placeholder="Ø³Ù†Ø©">

    <button class="save" onclick="save()">ğŸ’¾ Ø­ÙØ¸</button>
    <button class="close" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzTwerDEs4BoHQkXVQJdH4CWWUlN_uvfPbmOd5Q7WD9cbWZRzETfC6Nkpc506KQTa29qQ/exec";
let devices=[], editOld=null;

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function load(){
  fetch(`${API}?action=list`)
  .then(r=>r.json())
  .then(d=>{devices=d;draw(d)})
}

// Ø±Ø³Ù… Ø§Ù„ÙƒØ±ÙˆØª
function draw(data){
  const cards = document.getElementById("cards");
  cards.innerHTML="";
  data.forEach(x=>{
    let c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<div class="user">${x.usernumber}</div><div class="device">${x.snumber}</div>`;
    c.onclick=()=>edit(x);
    cards.appendChild(c);
  });
}

// ÙÙ„ØªØ±Ø© Ø§Ù„ÙƒØ±ÙˆØª
document.getElementById("search").addEventListener("input",()=>{
  let v=document.getElementById("search").value;
  draw(devices.filter(d=>String(d.snumber).includes(v)||String(d.usernumber).includes(v)));
});

// Ù„ØµÙ‚ Ù…Ù† Ø§Ù„Ø­Ø§ÙØ¸Ø©
function pasteFromClipboard(){
  navigator.clipboard.readText().then(text=>{
    if(!text) return;
    const clean = text.replace(/\D/g,""); // Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·
    document.getElementById("search").value = clean;
    document.getElementById("search").dispatchEvent(new Event("input")); // ÙÙ„ØªØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
  }).catch(()=>{
    alert("âš ï¸ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ù„ØµÙ‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ø§Ù„ØµÙ‚ ÙŠØ¯ÙˆÙŠÙ‹Ø§");
  });
}

// ÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ©
function openAdd(){
  editOld=null;
  document.getElementById("usernumber").value="";
  document.getElementById("snumber").value="";
  document.getElementById("vip1m").value="";
  document.getElementById("vip3m").value="";
  document.getElementById("vip6m").value="";
  document.getElementById("vip12m").value="";
  document.getElementById("modal").style.display="flex";
}

// ÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ ØªØ¹Ø¯ÙŠÙ„
function edit(d){
  editOld=d.snumber;
  document.getElementById("usernumber").value=d.usernumber;
  document.getElementById("snumber").value=d.snumber;
  document.getElementById("vip1m").value=d.vip1m;
  document.getElementById("vip3m").value=d.vip3m;
  document.getElementById("vip6m").value=d.vip6m;
  document.getElementById("vip12m").value=d.vip12m;
  document.getElementById("modal").style.display="flex";
}

// Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
function save(){
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² 12 Ø±Ù‚Ù…
  const sn = document.getElementById("snumber").value.replace(/\D/g,"");
  document.getElementById("snumber").value = sn;
  const un = document.getElementById("usernumber").value.replace(/\D/g,"");
  document.getElementById("usernumber").value = un;

  if(!sn || sn.length!==12 || !un){
    alert("âš ï¸ ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¬Ù‡Ø§Ø² ØµØ­ÙŠØ­ (12 Ø±Ù‚Ù…) ÙˆØ±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·");
    return;
  }

  let action = editOld ? "update&oldSnumber="+editOld : "add";
  fetch(`${API}?action=${action}&usernumber=${un}&snumber=${sn}&vip1m=${vip1m.value}&vip3m=${vip3m.value}&vip6m=${vip6m.value}&vip12m=${vip12m.value}`)
  .then(r=>r.json())
  .then(()=>{closeModal();load();});
}

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
function closeModal(){
  document.getElementById("modal").style.display="none";
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ±ÙˆØª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
load();
function draw(data){
  // ØªØ­Ø¯ÙŠØ« Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©
  document.getElementById("totalDevices").textContent = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©: ${data.length}`;

  const cards = document.getElementById("cards");
  cards.innerHTML="";
  data.forEach(x=>{
    let c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<div class="user">${x.usernumber}</div><div class="device">${x.snumber}</div>`;
    c.onclick=()=>edit(x);
    cards.appendChild(c);
  });
}

</script>

</body>
</html>
