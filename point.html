<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ† Ù„ÙˆØ­Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</title>
<style>
body { background:#0F172A; color:#fff; font-family:"Tajawal",sans-serif; padding:10px; text-align:center; }
input, button, select { padding:10px; margin:5px; font-size:16px; border-radius:10px; border:none; outline:none; }
input { width:200px; text-align:center; }
button { background:#01C38D; cursor:pointer; transition:.2s; }
button:hover { background:#00A97A; }
.result { background:#1E293B; padding:15px; border-radius:12px; margin-top:5px; font-size:14px; min-height:30px; display:flex; align-items:center; justify-content:center; }
table { width:90%; margin:auto; margin-top:5px; border-collapse:collapse; }
th, td { border:1px solid #fff; padding:2px; font-size:14px; }
th { background:#1E293B; }
.deleteBtn { background:#E11D48; padding:2px 10px; border-radius:6px; font-size:14px; }
.deleteBtn:hover { background:#9F1239; }
</style>
</head>
<body>

<h2>ğŸ† Ù„ÙˆØ­Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h2>

<input type="number" id="userNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨">
<button onclick="getPoints()">Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø·</button>
<br>

<input type="number" id="pointsToAdd" placeholder="Ù†Ù‚Ø§Ø· +">
<button onclick="addPoints()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø·</button>
<button onclick="resetPoints()">â™»ï¸ ØªØµÙÙŠØ± Ø§Ù„Ù†Ù‚Ø§Ø·</button>
<br>

<input type="number" id="newNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
<input type="number" id="newPoints" placeholder="Ù†Ù‚Ø§Ø· Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©">
<button onclick="addPlayer()">â• Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨</button>

<div id="result" class="result"></div>
<br>

<label>ğŸ“Š ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨:</label>
<select id="sortType" onchange="refreshRanking()">
  <option value="desc">Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·Ø§Ù‹</option>
  <option value="asc">Ø§Ù„Ø£Ù‚Ù„ Ù†Ù‚Ø§Ø·Ø§Ù‹</option>
  <option value="num">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø±Ù‚Ù…</option>
</select>
<br>
<input type="number" id="filterPoints" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„Ù†Ù‚Ø§Ø·">
<button onclick="filterByPoints()">ğŸ” ØªØµÙÙŠØ©</button>
<button onclick="refreshRanking()">ğŸ”„ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
<br>
<h3>ğŸ… ØªØ±ØªÙŠØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h3>
<table id="ranking">
<thead>
<tr>
  <th>Ø§Ù„Ø±Ù‚Ù…</th>
  <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
  <th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbw7RXPYnh15df-tyFio_dj6FHlJXCPz3oAquRsqXqTCu2lXjILC-agXDONLrLMkPByDiQ/exec";

function showMessage(msg, isError=false){
  const resultEl = document.getElementById("result");
  resultEl.textContent = msg;
  resultEl.style.color = isError ? "#FF4D4D" : "#01C38D";
}

function getPlayers(callback){
  fetch(API_URL)
    .then(res => res.json())
    .then(data => { if(!data.error) callback(data.players); });
}

function highlightLeaders(players){
  const maxPoints = Math.max(...players.map(p=>p.points));
  players.forEach(p=>{ p.isLeader = (p.points === maxPoints); });
}

function renderTable(players){
  const tbody = document.querySelector("#ranking tbody");
  tbody.innerHTML = "";
  highlightLeaders(players);

  const sort = document.getElementById("sortType").value;
  if(sort==="desc") players.sort((a,b)=>b.points-a.points);
  if(sort==="asc") players.sort((a,b)=>a.points-b.points);
  if(sort==="num") players.sort((a,b)=>a.number-b.number);

  players.forEach(p=>{
    const row = `<tr style="background:${p.isLeader?'#D4AF37':'#1E293B'};">
      <td>${p.isLeader?'ğŸ‘‘ ':''}${p.number}</td>
      <td>${p.points}</td>
      <td><button class="deleteBtn" onclick="deletePlayer('${p.number}')">ğŸ—‘ Ø­Ø°Ù</button></td>
    </tr>`;
    tbody.innerHTML += row;
  });
}

function refreshRanking(){ getPlayers(players=>renderTable(players)); }

function filterByPoints(){
  const val = document.getElementById("filterPoints").value.trim();
  if(!val) return alert("Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ù„ØªØµÙÙŠØ©");
  getPlayers(players=>{
    const filtered = players.filter(p=>p.points == val);
    renderTable(filtered);
  });
}

function getPoints() {
  const num = document.getElementById("userNumber").value.trim();
  if(!num) return alert("Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨");

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({number: num})
  })
  .then(res => res.json())
  .then(data => {
    if(data.error) showMessage("âŒ " + data.error, true);
    else if(data.points !== undefined)
      showMessage(`âœ… Ø±Ù‚Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨: ${data.number} | Ø§Ù„Ù†Ù‚Ø§Ø·: ${data.points}`);
    else
      showMessage("âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨", true);
    refreshRanking();
  })
  .catch(() => showMessage("âš ï¸ Ø®Ø·Ø£ Ø¨Ø§ØªØµØ§Ù„ Ø§Ù„Ø®Ø§Ø¯Ù…", true));
}



function addPoints(){
  const num = document.getElementById("userNumber").value.trim();
  const pts = document.getElementById("pointsToAdd").value.trim();
  if(!num || !pts) return alert("Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·");
  fetch(API_URL, {method:"POST", body:JSON.stringify({number:num, points:pts})})
    .then(res=>res.json())
    .then(data=>{
      if(data.error) showMessage("âŒ "+data.error,true);
      else{
        showMessage(`ğŸ¯ ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« | Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ${data.points}`);
        document.getElementById("pointsToAdd").value = "";
        refreshRanking();
      }
    });
}

function resetPoints(){
  const num = document.getElementById("userNumber").value.trim();
  if(!num) return alert("Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨");
  fetch(API_URL, {method:"POST", body:JSON.stringify({number:num, points:0})})
    .then(()=>{ showMessage("â™»ï¸ ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†Ù‚Ø§Ø·"); refreshRanking(); });
}

function addPlayer(){
  const num = document.getElementById("newNumber").value.trim();
  const pts = document.getElementById("newPoints").value.trim();
  if(!num || !pts) return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… ÙˆØ§Ù„Ù†Ù‚Ø§Ø· Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯");
  fetch(API_URL, {method:"POST", body:JSON.stringify({add:true, number:num, points:pts})})
    .then(res=>res.json())
    .then(data=>{
      if(data.error) showMessage("âŒ "+data.error,true);
      else {
        showMessage(`â• ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ ${data.number} | Ø¨Ø§Ù„Ù†Ù‚Ø§Ø· ${data.points}`);
        document.getElementById("newNumber").value = "";
        document.getElementById("newPoints").value = "";
        refreshRanking();
      }
    });
}

function deletePlayer(number){
  if(!confirm(`âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø±Ù‚Ù… ${number}ØŸ`)) return;

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({delete: true, number: number})
  })
  .then(res => res.json())
  .then(data => {
    if(data.error) showMessage("âŒ "+data.error,true);
    else {
      showMessage(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø±Ù‚Ù… ${number}`);
      refreshRanking();  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
    }
  })
  .catch(() => showMessage("âš ï¸ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…", true));
}


refreshRanking();
</script>

</body>
</html>
