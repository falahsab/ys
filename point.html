<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🏆 لوحة نقاط المسابقة</title>
<style>
body { background: #0F172A; color: #fff; font-family: "Tajawal", sans-serif; padding: 20px; text-align: center; }
input, button { padding: 10px; margin: 8px; font-size: 18px; border-radius: 10px; border: none; outline: none; }
input { width: 200px; text-align: center; }
button { background: #01C38D; cursor: pointer; transition: 0.2s; }
button:hover { background: #00A97A; }
.result { background:#1E293B; padding:15px; border-radius:12px; margin-top:20px; font-size:22px; min-height: 40px; display:flex; align-items:center; justify-content:center;}
table { width: 90%; margin:auto; margin-top:20px; border-collapse: collapse; }
th, td { border:1px solid #fff; padding:8px; font-size:18px; }
th { background:#1E293B; }
</style>
</head>
<body>

<h2>🏆 لوحة نقاط المسابقة</h2>

<input type="number" id="userNumber" placeholder="رقم اللاعب">
<button onclick="getPoints()">عرض النقاط</button>
<br>
<input type="number" id="pointsToAdd" placeholder="نقاط +">
<button onclick="addPoints()">إضافة النقاط</button>
<button onclick="resetPoints()">♻️ تصفير النقاط</button>
<br>
<input type="number" id="newNumber" placeholder="رقم اللاعب الجديد">
<input type="number" id="newPoints" placeholder="نقاط ابتدائية">
<button onclick="addPlayer()">➕ إضافة لاعب</button>

<div id="result" class="result"></div>

<h3>🏅 ترتيب اللاعبين</h3>
<table id="ranking">
<thead>
<tr>
  <th>الرقم</th>
  <th>النقاط</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwDKAydttnPT7uahoqkuEnVUfHsSzNf1cTk3kaMtga_ASWqM6UdKS6OfBjBvy3lkU6nfA/exec";

function showMessage(msg, isError = false) {
  const resultEl = document.getElementById("result");
  resultEl.textContent = msg;
  resultEl.style.color = isError ? "#FF4D4D" : "#01C38D";
}

function getPoints() {
  const userNumber = document.getElementById("userNumber").value.trim();
  if (!userNumber) return alert("ادخل رقم اللاعب");

  fetch(`${API_URL}?number=${encodeURIComponent(userNumber)}`)
    .then(res => res.json())
    .then(data => {
      if (data.error) showMessage("❌ " + data.error, true);
      else showMessage(`✅ رقم اللاعب: ${data.number} | النقاط: ${data.points}`);
      refreshRanking();
    })
    .catch(() => showMessage("⚠️ خطأ باتصال الخادم", true));
}

function addPoints() {
  const userNumber = document.getElementById("userNumber").value.trim();
  const points = document.getElementById("pointsToAdd").value.trim();
  if (!userNumber || !points) return alert("ادخل رقم اللاعب وعدد النقاط");

  fetch(`${API_URL}?number=${encodeURIComponent(userNumber)}&points=${encodeURIComponent(points)}`)
    .then(res => res.json())
    .then(data => {
      if (data.error) showMessage("❌ " + data.error, true);
      else {
        showMessage(`🎯 تم التحديث | النقاط الجديدة: ${data.points}`);
        document.getElementById("pointsToAdd").value = "";
        refreshRanking();
      }
    })
    .catch(() => showMessage("⚠️ خطأ أثناء حفظ البيانات", true));
}

function resetPoints() {
  const userNumber = document.getElementById("userNumber").value.trim();
  if(!userNumber) return alert("ادخل رقم اللاعب");

  fetch(`${API_URL}?number=${encodeURIComponent(userNumber)}&points=0`)
    .then(res => res.json())
    .then(data => {
      if(data.error) showMessage("❌ "+data.error,true);
      else {
        showMessage(`♻️ تم تصفير النقاط`);
        refreshRanking();
      }
    });
}

// إضافة لاعب جديد
function addPlayer() {
  const newNumber = document.getElementById("newNumber").value.trim();
  const newPoints = document.getElementById("newPoints").value.trim();
  if(!newNumber || !newPoints) return alert("ادخل الرقم والنقاط للاعب الجديد");

  fetch(`${API_URL}?number=${encodeURIComponent(newNumber)}&points=${encodeURIComponent(newPoints)}&add=true`)
    .then(res => res.json())
    .then(data => {
      if(data.error) showMessage("❌ "+data.error,true);
      else {
        showMessage(`➕ تم إضافة اللاعب ${data.number} بالنقاط ${data.points}`);
        document.getElementById("newNumber").value = "";
        document.getElementById("newPoints").value = "";
        refreshRanking();
      }
    });
}

// تحديث ترتيب اللاعبين
function refreshRanking() {
  fetch(`${API_URL}`)
    .then(res => res.json())
    .then(data => {
      if(data.error) return;
      const tbody = document.querySelector("#ranking tbody");
      tbody.innerHTML = "";
      data.players.sort((a,b) => b.point - a.point);
      data.players.forEach(p => {
        const color = p.point >= 50 ? '#01C38D' : (p.point >= 20 ? '#FFC107' : '#FF4D4D');
        const row = `<tr style="background:${color};">
          <td>${p.number}</td>
          <td>${p.point}</td>
        </tr>`;
        tbody.innerHTML += row;
      });
    });
}

// عند تحميل الصفحة
refreshRanking();
</script>

</body>
</html>
