<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙˆØ²Ø¹</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{font-family:Tahoma;background:#f4f6f9;margin:0;padding:15px}
.container{
  max-width:1100px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 20px rgba(0,0,0,.1);
}
h3{color:#0d6efd}
button{
  padding:10px 14px;
  border:none;
  border-radius:6px;
  background:#0d6efd;
  color:#fff;
  cursor:pointer;
}
button.logout{background:#dc3545}
.summary{
  background:#e9f5ff;
  padding:12px;
  margin:10px 0;
  border-radius:6px;
  font-weight:bold;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
  font-size:13px;
}
th,td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center;
}
th{background:#0d6efd;color:#fff}
.status-Refund{color:red;font-weight:bold}
</style>
</head>

<body>

<div class="container">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h3 id="welcome"></h3>
    <button class="logout" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
  </div>

  <div class="summary">
    ðŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø¨Ø­: <span id="totalProfit">0</span> Ø±ÙŠØ§Ù„
  </div>

  <table id="dataTable">
    <thead>
      <tr>
        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
        <th>User</th>
        <th>SN</th>
        <th>Ø§Ù„Ø±Ø¨Ø­</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <br>
  <button onclick="exportExcel()">ØªØ­Ù…ÙŠÙ„ Excel</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz9-PcXjV4RxpN6996rhgyYIScNbo8rDnhROrAh_Lp3b75lnwqX5k_I0nafkIJ8WjgJZQ/exec";

// Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„
let dealer = sessionStorage.getItem("dealer");
if(!dealer){
  window.location.href = "/login.html";
}

document.getElementById("welcome").innerText = "Ù…Ø±Ø­Ø¨Ù‹Ø§ " + dealer;

fetch(API_URL,{
  method:"POST",
  body:JSON.stringify({ dealer: dealer })
})
.then(r=>r.json())
.then(d=>{
  let tbody = document.querySelector("tbody");
  let total = 0;

  d.data.forEach(r=>{
    total += Number(r[5]) || 0;
    let tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r[0].split("T")[0]}</td>
      <td>${r[1]}</td>
      <td>${r[2]}</td>
      <td>${r[3]}</td>
      <td>${r[4]}</td>
      <td>${r[5]}</td>
      <td class="${r[6]==='Refund'?'status-Refund':''}">${r[6]}</td>
    `;
    tbody.appendChild(tr);
  });

  totalProfit.innerText = total.toLocaleString();
});

function logout(){
  sessionStorage.clear();
  window.location.href = "login.html";
}

function exportExcel(){
  let wb = XLSX.utils.table_to_book(dataTable,{sheet:"Report"});
  XLSX.writeFile(wb,"dealer_report.xlsx");
}
</script>

</body>
</html>
