<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ† Ù„ÙˆØ­Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</title>

<style>
body { background:#0F172A; color:#fff; font-family:"Tajawal",sans-serif; padding:20px; text-align:center; }
input, button, select { padding:10px; margin:8px; font-size:18px; border-radius:10px; border:none; outline:none; }
input { width:200px; text-align:center; }
button { background:#01C38D; cursor:pointer; transition:.2s; }
button:hover { background:#00A97A; }
.result { background:#1E293B; padding:15px; border-radius:12px; margin-top:20px; font-size:22px; min-height:40px; display:flex; align-items:center; justify-content:center; }
table { width:90%; margin:auto; margin-top:20px; border-collapse:collapse; }
th, td { border:1px solid #fff; padding:5px; font-size:14px; }
th { background:#1E293B; }
.deleteBtn { background:#E11D48; padding:6px 10px; border-radius:6px; font-size:16px; }
.deleteBtn:hover { background:#9F1239; }
</style>
</head>

<body>

<h2>ğŸ† Ù„ÙˆØ­Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h2>

<input type="number" id="userNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨">
<button onclick="getPoints()">Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø·</button>
<br>
<div id="result" class="result"></div>
<br>
<input type="number" id="filterPoints" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„Ù†Ù‚Ø§Ø·">
<button onclick="filterByPoints()">ğŸ” ØªØµÙÙŠØ©</button>
<button onclick="refreshRanking()">ğŸ”„ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
<br>
<h3>ğŸ… ØªØ±ØªÙŠØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h3>
<table id="ranking">
<thead>
<tr>
  <th>Ø§Ù„Ø±Ù‚Ù…</th>
  <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwDKAydttnPT7uahoqkuEnVUfHsSzNf1cTk3kaMtga_ASWqM6UdKS6OfBjBvy3lkU6nfA/exec";

function showMessage(msg, isError = false) {
  const resultEl = document.getElementById("result");
  resultEl.textContent = msg;
  resultEl.style.color = isError ? "#FF4D4D" : "#01C38D";
}

// Ø¬Ù„Ø¨ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† API
function getPlayers(callback) {
  fetch(`${API_URL}`)
    .then(res => res.json())
    .then(data => {
      if (!data.error) callback(data.players);
    });
}

// Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† Ø¨Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ ÙˆØªØ§Ø¬
function highlightLeaders(players) {
  let maxPoints = Math.max(...players.map(p => p.point));
  players.forEach(p => {
    if (p.point === maxPoints) {
      p.isLeader = true;
    }
  });
}

// ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨
function renderTable(players) {
  const tbody = document.querySelector("#ranking tbody");
  tbody.innerHTML = "";

  highlightLeaders(players);

  players.sort((a, b) => b.point - a.point).forEach(p => {
    const row = `<tr style="background:${p.isLeader ? '#D4AF37' : '#1E293B'};">
      <td>${p.isLeader ? "ğŸ‘‘ " : ""}${p.number}</td>
      <td>${p.point}</td>
    </tr>`;
    tbody.innerHTML += row;
  });
}

function refreshRanking() {
  getPlayers(players => renderTable(players));
}

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
function filterByPoints() {
  const value = document.getElementById("filterPoints").value.trim();
  if (!value) return alert("Ø§ÙƒØªØ¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„ÙŠÙ‡Ø§");

  getPlayers(players => {
    let filtered = players.filter(p => p.point == value);
    renderTable(filtered);
  });
}

/* ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù†Ù‚Ø§Ø· ÙƒÙ…Ø§ Ù‡ÙŠ */
function getPoints() {
  const userNumber = document.getElementById("userNumber").value.trim();
  if (!userNumber) return alert("Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨");

  fetch(`${API_URL}?number=${encodeURIComponent(userNumber)}`)
    .then(res => res.json())
    .then(data => {
      if (data.error) showMessage("âŒ " + data.error, true);
      else showMessage(`âœ… Ø±Ù‚Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨: ${data.number} | Ø§Ù„Ù†Ù‚Ø§Ø·: ${data.points}`);
      refreshRanking();
    })
    .catch(() => showMessage("âš ï¸ Ø®Ø·Ø£ Ø¨Ø§ØªØµØ§Ù„ Ø§Ù„Ø®Ø§Ø¯Ù…", true));
}

function addPoints() {
  const userNumber = document.getElementById("userNumber").value.trim();
  const points = document.getElementById("pointsToAdd").value.trim();
  if (!userNumber || !points) return alert("Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·");

  fetch(`${API_URL}?number=${encodeURIComponent(userNumber)}&points=${encodeURIComponent(points)}`)
    .then(res => res.json())
    .then(data => {
      if (data.error) showMessage("âŒ " + data.error, true);
      else {
        showMessage(`ğŸ¯ ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« | Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ${data.points}`);
        document.getElementById("pointsToAdd").value = "";
        refreshRanking();
      }
    })
    .catch(() => showMessage("âš ï¸ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", true));
}

function resetPoints() {
  const userNumber = document.getElementById("userNumber").value.trim();
  if(!userNumber) return alert("Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨");

  fetch(`${API_URL}?number=${encodeURIComponent(userNumber)}&points=0`)
    .then(res => res.json())
    .then(() => {
      showMessage(`â™»ï¸ ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†Ù‚Ø§Ø·`);
      refreshRanking();
    });
}

function addPlayer() {
  const newNumber = document.getElementById("newNumber").value.trim();
  const newPoints = document.getElementById("newPoints").value.trim();
  if(!newNumber || !newPoints) return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… ÙˆØ§Ù„Ù†Ù‚Ø§Ø· Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯");

  fetch(`${API_URL}?number=${encodeURIComponent(newNumber)}&points=${encodeURIComponent(newPoints)}&add=true`)
    .then(res => res.json())
    .then(data => {
      if(data.error) showMessage("âŒ "+data.error,true);
      else {
        showMessage(`â• ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ ${data.number} Ø¨Ø§Ù„Ù†Ù‚Ø§Ø· ${data.points}`);
        document.getElementById("newNumber").value = "";
        document.getElementById("newPoints").value = "";
        refreshRanking();
      }
    });
}

refreshRanking();
</script>

</body>
</html>
